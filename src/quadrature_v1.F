C-----------------------------------------------------------------------
C
C     Subroutine QUADRATURE
C
C     Written by Ethan Kubatko (02-05-2010)
C
C     This subroutine returns the weights and points of a D degree
C     quadrature rule for a given region.  Regions may be one of the
C     following:
C
C       EDGE:       -1 <= X <= 1
C       TRIANGLE:   -1 <= X =< 1, -1 <= Y < 1,  X + Y <= 0
C       SQUARE:     -1 <= X =< 1, -1 <= Y < 1,
C       TRIPRISM:   -1 <= X <= 1, -1 <= Y <= 1, -1 <= Z <= 1, X + Y <= 0
C
C     Edge rules are standard Gauss-Legendre rules.  The remaining rules
C     are obtained from a number of different sources listed below. The
C     references for particular rules are noted below.
C
C-----------------------------------------------------------------------
C
C     Input:
C     ------
C       D:       Polynomial degree of rule
C       REGION:  EDGE, TRIANGLE, SQUARE, or TRIPRISM (prism with a tri-
C                angular base)
C
C     Output:
C     -------
C       PTS: Array of quadrature points of size QUAD_PTS by DIM where
C            QUAD_PTS is the number of points for a given rule and DIM
C            (=1 ,2, or 3) is the dimension of the region.
C       WTS: Array of quadrature weights of size QUAD_PTS by 1.
C
C-----------------------------------------------------------------------

      SUBROUTINE QUADRATURE( D, REGION, PTS, WTS, N, SZ2, SZ3 )
      USE SIZES

      IMPLICIT NONE

C.....Declare subroutine input and output

      INTEGER :: D, SZ2, SZ3
      CHARACTER(LEN = 8) :: REGION
      INTEGER :: N
      REAL(SZ) :: PTS(SZ2,SZ3)
      REAL(SZ) :: WTS(SZ2)

      INTEGER :: I, J, K, L
      REAL(SZ) :: AREA
      REAL(SZ) :: V1(2), V2(2), V3(2)
      REAL(SZ), ALLOCATABLE :: A(:), B(:), C(:), M(:), W(:)

C-----------------------------------------------------------------------
C                        EDGE QUADRATURE RULES
C-----------------------------------------------------------------------
C
C     Notes: (1) These are standard Gauss-Legendre rules.
C            (2) An n point Gauss-Legendre quadrature rule will
C                integrate up to a 2n-1 degree polynomial exactly.
C
C-----------------------------------------------------------------------

      IF (REGION == 'EDGE    ') THEN
        N = CEILING((D+1)/2.)
        L = CEILING(N/2.)
C-----------------------------------------------------------------------
        IF (D.LE.1) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = 0.000000000000000D0  ! Point
          WTS(1)   = 1.000000000000000D0  ! Weight
C-----------------------------------------------------------------------
        ELSEIF (D.LE.3) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.57735026918963D0  ! Points
          WTS(1)   =  1.00000000000000D0  ! Weights
C-----------------------------------------------------------------------
        ELSEIF (D.LE.5) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.77459666924148D0  ! Points
          PTS(2,1) =  0.00000000000000D0
          WTS(1)   =  0.55555555555556D0  ! Weights
          WTS(2)   =  0.88888888888888D0
C-----------------------------------------------------------------------
        ELSEIF (D.LE.7) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.86113631159405D0  ! Points
          PTS(2,1) = -0.33998104358486D0
          WTS(1)   =  0.34785484513745D0  ! Weights
          WTS(2)   =  0.65214515486255D0
C-----------------------------------------------------------------------
        ELSEIF (D.LE.9) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.90617984593866D0  ! Points
          PTS(2,1) = -0.53846931010568D0
          PTS(3,1) =  0.00000000000000D0
          WTS(1)   =  0.23692688505619D0  ! Weights
          WTS(2)   =  0.47862867049937D0
          WTS(3)   =  0.56888888888889D0
C-----------------------------------------------------------------------
        ELSEIF (D.LE.11) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.93246951420315D0  ! Points
          PTS(2,1) = -0.66120938646626D0
          PTS(3,1) = -0.23861918608320D0
          WTS(1)   =  0.17132449237917D0  ! Weights
          WTS(2)   =  0.36076157304814D0
          WTS(3)   =  0.46791393457269D0
C-----------------------------------------------------------------------
        ELSEIF (D.LE.13) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.94910791234276D0  ! Points
          PTS(2,1) = -0.74153118559939D0
          PTS(3,1) = -0.40584515137740D0
          PTS(4,1) =  0.D0
          WTS(1)   =  0.12948496616887D0  ! Weights
          WTS(2)   =  0.27970539148928D0
          WTS(3)   =  0.38183005050512D0
          WTS(4)   =  0.41795918367347D0
C-----------------------------------------------------------------------
        ELSEIF (D.LE.15) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.96028985649754D0  ! Points
          PTS(2,1) = -0.79666647741363D0
          PTS(3,1) = -0.52553240991633D0
          PTS(4,1) = -0.18343464249565D0
          WTS(1)   =  0.10122853629038D0  ! Weights
          WTS(2)   =  0.22238103445337D0
          WTS(3)   =  0.31370664587789D0
          WTS(4)   =  0.36268378337836D0
C-----------------------------------------------------------------------
        ELSEIF (D.LE.17) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.96816023950763D0  ! Points
          PTS(2,1) = -0.83603110732664D0
          PTS(3,1) = -0.61337143270059D0
          PTS(4,1) = -0.32425342340381D0
          PTS(5,1) =  0.00000000000000D0
          WTS(1)   =  0.08127438836163D0  ! Weights
          WTS(2)   =  0.18064816069483D0
          WTS(3)   =  0.26061069640294D0
          WTS(4)   =  0.31234707704000D0
          WTS(5)   =  0.33023935500126D0
C-----------------------------------------------------------------------
        ELSEIF (D.LE.19) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.97390652851717D0! Points
          PTS(2,1) = -0.86506336668898D0
          PTS(3,1) = -0.67940956829902D0
          PTS(4,1) = -0.43339539412925D0
          PTS(5,1) = -0.14887433898163D0
          WTS(1)   =  0.06667134430869D0  ! Weights
          WTS(2)   =  0.14945134915058D0
          WTS(3)   =  0.21908636251598D0
          WTS(4)   =  0.26926671931000D0
          WTS(5)   =  0.29552422471475D0
C-----------------------------------------------------------------------
        ELSEIF (D.LE.21) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.97822865814606D0  ! Points
          PTS(2,1) = -0.88706259976810D0
          PTS(3,1) = -0.73015200557405D0
          PTS(4,1) = -0.51909612920681D0
          PTS(5,1) = -0.26954315595234D0
          PTS(6,1) =  0.00000000000000D0
          WTS(1)   =  0.05566856711627D0  ! Weights
          WTS(2)   =  0.12558036946485D0
          WTS(3)   =  0.18629021092774D0
          WTS(4)   =  0.23319376459199D0
          WTS(5)   =  0.26280454451025D0
          WTS(6)   =  0.27292508677790D0
C-----------------------------------------------------------------------
        ELSEIF (D.LE.23) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.98156063424672D0 ! Points
          PTS(2,1) = -0.90411725637047D0
          PTS(3,1) = -0.76990267419430D0
          PTS(4,1) = -0.58731795428662D0
          PTS(5,1) = -0.36783149899818D0
          PTS(6,1) = -0.12523340851147D0
          WTS(1)   =  0.04717533638677D0  ! Weights
          WTS(2)   =  0.10693932599520D0
          WTS(3)   =  0.16007832854334D0
          WTS(4)   =  0.20316742672308D0
          WTS(5)   =  0.23349253653835D0
          WTS(6)   =  0.24914704581340D0
C-----------------------------------------------------------------------
        ELSEIF (D.LE.25) THEN
C-----------------------------------------------------------------------
          PTS(1,1) = -0.98418305471859D0  ! Points
          PTS(2,1) = -0.91759839922298D0
          PTS(3,1) = -0.80157809073331D0
          PTS(4,1) = -0.64234933944034D0
          PTS(5,1) = -0.44849275103645D0
          PTS(6,1) = -0.23045831595513D0
          PTS(7,1) =  0.00000000000000D0
          WTS(1)   =  0.04048400476532D0  ! Weights
          WTS(2)   =  0.09212149983773D0
          WTS(3)   =  0.13887351021979D0
          WTS(4)   =  0.17814598076195D0
          WTS(5)   =  0.20781604753689D0
          WTS(6)   =  0.22628318026290D0
          WTS(7)   =  0.23255155323087D0
C-----------------------------------------------------------------------
        ELSE
C-----------------------------------------------------------------------
          call quad_rules_general(N, .false., 0.0, 0.0, pts, wts)
        
        ENDIF
C-----------------------------------------------------------------------
        J = MOD(N,2)
        DO I = L,N
          PTS(I+1,1) = -PTS(L-J,1)
          WTS(I+1)   =  WTS(L-J)
          J = J + 1
        ENDDO
C-----------------------------------------------------------------------
C                        TRIANGLE QUADRATURE RULES
C-----------------------------------------------------------------------
C
C     All rules have positive weights with all points located inside the
C     triangle (so-called PI rules). Rules marked by * are optimal.
C
C     References:

C     [1] D.A. Dunavant, "High Degree Efficient Symmetrical Gaussian
C         Quadrature Rules for the Triangle", International Journal for
C         Numerical Methods in Engineering, 21, 1129--1148, 1985.
C
C     [2] L. Zhang, T. Cui, and Hui Liu, "A Set of Symmetric Quadrature
C         Rules on Triangles and Tetrahedra", Journal of Computational
C         Mathematics, 27, 89--96, 2009.
C
C     [3] P. Hillion, "Numerical Integration on a triangle",
C         International Journal for Numerical Methods in Engineering,
C         11, 797--815, 1977.
C
C     [4] K. Gatermann, "The construction of symmetric cubature formulas
C         for the square and the triangle, Computing, 40, 229--240,
C         1988.
C
C-----------------------------------------------------------------------

      ELSEIF (REGION == 'TRIANGLE') THEN

C-----------------------------------------------------------------------
        IF (D.LE.1) THEN                                      ! Ref [1]*
C-----------------------------------------------------------------------
          L = 1
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1 /)                                     ! Multip.
          A(1:L) = (/ 0.3333333333333333333333333333333333D0 /)! Points
          W(1:L) = (/ 1.0000000000000000000000000000000000D0 /)! Weights
C-----------------------------------------------------------------------
        ELSEIF (D.LE.2) THEN                                  ! Ref [1]*
C-----------------------------------------------------------------------
          L = 1
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 3 /)                                     ! Multip.
          A(1:L) = (/ 0.1666666666666666666666666666666666D0 /)! Points
          W(1:L) = (/ 0.3333333333333333333333333333333333D0 /)! Weights
C-----------------------------------------------------------------------
c        ELSEIF (D.LE.3) THEN                                  ! Ref [3]*
C-----------------------------------------------------------------------
C-----------------------------------------------------------------------
        ELSEIF (D.LE.4) THEN                                  ! Ref [2]*
C-----------------------------------------------------------------------
          L = 2
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 3,3 /)                                   ! Multip.
          A(1:L) = (/ 0.4459484909159648863183292538830519D0,  ! Points
     &                0.0915762135097707434595714634022015D0 /)
          W(1:L) = (/ 0.2233815896780114656950070084331228D0,  ! Weights
     &                0.1099517436553218676383263249002105D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.5) THEN                                  ! Ref [1]*
C-----------------------------------------------------------------------
          L = 3
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3 /)                                 ! Multip.
          A(1:L) = (/ 0.3333333333333333333333333333333333D0,  ! Points
     &                0.4701420641051150897704412095134476D0,
     &                0.1012865073234563388009873619151238D0 /)
          W(1:L) = (/ 0.2250000000000000000000000000000000D0,  ! Weights
     &                0.1323941527885061807376493878331519D0,
     &                0.1259391805448271525956839455001813D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.6) THEN                                  ! Ref [1]
C-----------------------------------------------------------------------
          L = 3
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 3,3,6 /)                                 ! Multip.
          A(1:L) = (/ 0.0630890144915022283403316028708192D0,  ! Points
     &                0.2492867451709104212916385531070191D0,
     &                0.0531450498448169473532496716313981D0 /)
          B(3:3) = (/ 0.3103524510337844054166077339565522D0 /)
          W(1:L) = (/ 0.0508449063702068169209368091068690D0,  ! Weights
     &                0.1167862757263793660252896113855794D0,
     &                0.0828510756183735751935534564204425D0 /)
C-----------------------------------------------------------------------
c        ELSEIF (D.LE.7) THEN                                  ! Ref [4]*
C-----------------------------------------------------------------------
C          L = 4
C          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
C          M(1:L) = (/ 3,3,3,3 /)
C          A(1:L) = (/ /)
C          B(1:L) = (/ /)
C          W(1:L) = (/ /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.8) THEN                                  ! Ref [1]
C-----------------------------------------------------------------------
          L = 5
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,6 /)                             ! Multip.
          A(1:L) = (/ 0.3333333333333333333333333333333333D0,  ! Points
     &                0.1705693077517602066222935014914645D0,
     &                0.0505472283170309754584235505965989D0,
     &                0.4592925882927231560288155144941693D0,
     &                0.2631128296346381134217857862846436D0 /)
          B(5:5) = (/ 0.0083947774099576053372138345392944D0 /)
          W(1:L) = (/ 0.1443156076777871682510911104890646D0,  ! Weights
     &                0.1032173705347182502817915502921290D0,
     &                0.0324584976231980803109259283417806D0,
     &                0.0950916342672846247938961043885843D0,
     &                0.0272303141744349942648446900739089D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.9) THEN                                  ! Ref [1]
C-----------------------------------------------------------------------
          L = 6
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,6 /)                           ! Multip.
          A(1:L) = (/ 0.3333333333333333333333333333333333D0,  ! Points
     &                0.4896825191987376277837069248361928D0,
     &                0.0447295133944527098651065899662764D0,
     &                0.4370895914929366372699303644353550D0,
     &                0.1882035356190327302409612804673356D0,
     &                0.7411985987844980206900798735234238D0 /)
          B(6:6) = (/ 0.2219629891607656956751025276931911D0 /)
          W(1:L) = (/ 0.0971357962827988338192419825072886D0,  ! Weights
     &                0.0313347002271390705368548312872093D0,
     &                0.0255776756586980312616787985589998D0,
     &                0.0778275410047742793167393562994040D0,
     &                0.0796477389272102530328917742640453D0,
     &                0.0432835393772893772893772893772894D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.10) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 7
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,6,6 /)                         ! Multip.
          A(1:L) = (/ 0.3333333333333333333333333333333333D0,  ! Points
     &                0.4272731788467755380904427175154472D0,
     &                0.1830992224486750205215743848502200D0,
     &                0.4904340197011305874539712223768484D0,
     &                0.0125724455515805327313290850210413D0,
     &                0.6542686679200661406665700955876279D0,
     &                0.1228045770685592734301298174812812D0 /)
          B(6:7) = (/ 0.3080460016852477000000000000000000D0,
     &                0.0333718337393047862408164417747804D0 /)
          W(1:L) = (/ 0.0809374287976228802571131238165019D0,  ! Weights
     &                0.0772985880029631216825069823803434D0,
     &                0.0784576386123717313680939208343967D0,
     &                0.0174691679959294869176071632906781D0,
     &                0.0042923741848328280304804020901319D0,
     &                0.0374688582104676429790207654850445D0,
     &                0.0269493525918799596454494795810967D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.11) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 8
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,3,6,6 /)                       ! Multip.
          A(1:L) = (/ 0.3333333333333333333333333333333333D0,  ! Points
     &                0.0309383552454307848951950149913047D0,
     &                0.4364981811341288419176152765599732D0,
     &                0.4989847637025932662879869838313909D0,
     &                0.2146881979585943366068758138782509D0,
     &                0.1136831040421133902052931562283618D0,
     &                0.8256187661648629043588062003083580D0,
     &                0.6404723101348652676770365908189668D0 /)
          B(7:8) = (/ 0.1597423045918501898008607882250075D0,
     &                0.3117837157095990000000000000000000D0 /)
          W(1:L) = (/ 0.0811779602968671595154759687498236D0,
     &                0.0123240435069094941184739010162328D0,  ! Weights
     &                0.0628280097444101072833394281602940D0,
     &                0.0122203790493645297552122150039379D0,
     &                0.0677013489528115099209888618232256D0,
     &                0.0402196936288516904235668896075687D0,
     &                0.0147622727177161013362930655877821D0,
     &                0.0407279964582990396603369584816179D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.12) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 8
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 3,3,3,3,3,6,6,6 /)                       ! Multip.
          A(1:L) = (/ 0.0213173504532103702468569755157282D0,  ! Points
     &                0.2712103850121159223459513403968947D0,
     &                0.1275761455415859246738963251542836D0,
     &                0.4397243922944602729797366234843611D0,
     &                0.4882173897738048825646620652588110D0,
     &                0.6958360867878034221416355232360725D0,
     &                0.8580140335440726305905366166261782D0,
     &                0.6089432357797878068561924377637101D0 /)
          B(6:8) = (/ 0.2813255809899395482481306929745527D0,
     &                0.1162519159075971412413541478426018D0,
     &                0.2757132696855141939747963460797640D0 /)
          W(1:L) = (/ 0.0061662610515590172338664837852304D0,  ! Weights
     &                0.0628582242178851003542705130928825D0,
     &                0.0347961129307089429893283972949994D0,
     &                0.0436925445380384021354572625574750D0,
     &                0.0257310664404553354177909230715644D0,
     &                0.0223567732023034457118390767023200D0,
     &                0.0173162311086588923716421008110341D0,
     &                0.0403715577663809295178286992522368D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.13) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 9
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,6,6,6,6 /)                     ! Multip.
          A(1:L) = (/ 0.3333333333333333333333333333333333D0,  ! Points
     &                0.4269414142598004060208125350313742D0,
     &                0.2213722862918329006548125547050791D0,
     &                0.0215096811088431838692913135340521D0,
     &                0.4890769464525393499006897190902044D0,
     &                0.6235459955536755708158543531862366D0,
     &                0.8647077702954427753025459508956932D0,
     &                0.7485071158999521951730185957887097D0,
     &                0.7223577931241879652606201323047840D0 /)
          B(6:9) = (/ 0.3084417608921177746584718525412453D0,
     &                0.1109220428034633954128695452216745D0,
     &                0.1635974010678504802338879017109572D0,
     &                0.2725158177734296661800504643540868D0 /)
          W(1:L) = (/ 0.0679600365868316442817744246808849D0,
     &                0.0556019675304533287072574660104615D0,  ! Weights
     &                0.0582784851191999814047670835133398D0,
     &                0.0060523371035391718417928000322908D0,
     &                0.0239944019288947307737107994509597D0,
     &                0.0346412761408483704659868285109182D0,
     &                0.0149654011051656672632458571329034D0,
     &                0.0241790398115938191374457455730608D0,
     &                0.0095906810035432627225950901661109D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.14) THEN                                 ! Ref [1]
C-----------------------------------------------------------------------
          L = 10
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 3,3,3,3,3,3,6,6,6,6 /)                 ! Multipl.
          A(1:L) = (/ 0.48896391036217900000000000000000D0,    ! Points
     &                0.41764471934045400000000000000000D0,
     &                0.27347752830883900000000000000000D0,
     &                0.17720553241254300000000000000000D0,
     &                0.06179988309087300000000000000000D0,
     &                0.01939096124870100000000000000000D0,
     &                0.17226668782135600000000000000000D0,
     &                0.33686145979634500000000000000000D0,
     &                0.29837288213625800000000000000000D0,
     &                0.11897449769695700000000000000000D0 /)
          B(7:L) = (/ 0.77060855477499600000000000000000D0,
     &                0.57022229084668300000000000000000D0,
     &                0.68698016780808800000000000000000D0,
     &                0.87975717137017100000000000000000D0 /)
          W(1:L) = (/ 0.02188358136942900000000000000000D0,    ! Weights
     &                0.03278835354412500000000000000000D0,
     &                0.05177410450729200000000000000000D0,
     &                0.04216258873699300000000000000000D0,
     &                0.01443369966977700000000000000000D0,
     &                0.00492340360240000000000000000000D0,
     &                0.02466575321256400000000000000000D0,
     &                0.03857151078706100000000000000000D0,
     &                0.01443630811353400000000000000000D0,
     &                0.00501022883850100000000000000000D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.15) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 13
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,3,3,3,6,6,6,6,6 /)             ! Multip.
          A(1:L) = (/ 0.3333333333333333333333333333333333D0,  ! Points
     &                0.2273322188191428742025043684922941D0,
     &                0.4971625774318874298738098000160233D0,
     &                0.4788497353489545833392292001438526D0,
     &                0.4049860390982719916972446423426920D0,
     &                0.0159312166717444321134277329412690D0,
     &                0.1655832624260814000000000000000000D0,
     &                0.0731336047192287277268738121073244D0,
     &                0.6652607330722139390623644133856912D0,
     &                0.7125219872425455330488490116233878D0,
     &                0.5596483622353932184122484540192300D0,
     &                0.8104765976190768630468327302905713D0,
     &                0.9160756440317311885646088387783200D0 /)
          B(9:L) = (/ 0.3163528393449472300863381309502453D0,
     &                0.0934607511499175300000000000000005D0,
     &                0.3442290175821932000000000000000016D0,
     &                0.1710472483142579515476503319255848D0,
     &                0.0730559964791864896129490819274250D0 /)
          W(1:L) = (/ 0.0440387108784342798530173272149339D0,  ! Weights
     &                0.0461847871820269799487156676019167D0,
     &                0.0064989066173327165268828034928102D0,
     &                0.0179936142526584032446699241671566D0,
     &                0.0417731050391413541196860605641460D0,
     &                0.0030595476091164665484301699283448D0,
     &                0.0020124350525586473440903187565405D0,
     &                0.0167756109305091223261114568879588D0,
     &                0.0154607491897142748660880304092474D0,
     &                0.0284998903395474233927395587533020D0,
     &                0.0320943504834895956420992357370957D0,
     &                0.0115085816368707112840232437732419D0,
     &                0.0046143065289671031435871760918541D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.16) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 13
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,3,3,6,6,6,6,6,6 /)             ! Multip.
          A(1:L) = (/ 0.3333333333333333333333333333333333D0,  ! Points
     &                0.0817949831313738726414655931188610D0,
     &                0.1653006019697796506267619329335566D0,
     &                0.4685921053494613866946028972966056D0,
     &                0.0144388134454166826141089566956602D0,
     &                0.2417842853917833534068944592932077D0,
     &                0.4953103429877699640654950868774055D0,
     &                0.6505134026613522994311446848416867D0,
     &                0.6040112814959970398494041030359670D0,
     &                0.8021682575747416636168619478116671D0,
     &                0.7565056064428283965511540757580608D0,
     &                0.4659384387141181848838107335915464D0,
     &                0.9063948439920415013624996618653400D0 /)
          B(8:L) = (/ 0.3313997445370895565813231681825939D0,
     &                0.3032471627499421850415521780783469D0,
     &                0.1880280595212371734441821142939888D0,
     &                0.1835046685222968636823802774370004D0,
     &                0.3596459487975046000000000000000100D0,
     &                0.0771943712957554322825152250527139D0 /)
          W(1:L) = (/ 0.0480221886803770905518394045805199D0,  ! Weights
     &                0.0147091003068019271034036428618692D0,
     &                0.0295445865493192559953097267964641D0,
     &                0.0261250173510883774985975654917156D0,
     &                0.0027803873523900069750030161386621D0,
     &                0.0318217730005366495034272900559496D0,
     &                0.0086458343495096599011737341698489D0,
     &                0.0143003329044953651466164253682521D0,
     &                0.0278497772036008299522298734239535D0,
     &                0.0070416734066360975623701880892807D0,
     &                0.0178998382599337286017702090758108D0,
     &                0.0274582003843497630724700381009172D0,
     &                0.0072997969394317620841125440877777D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.17) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 14
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,3,3,6,6,6,6,6,6,6 /)           ! Multip.
          A(1:L) = (/ 0.3333333333333333333333333333333333D0,  ! Points
     &                0.0956985088627109399431625786023763D0,
     &                0.1701386396787754467232472307956844D0,
     &                0.4180206858679549762226346423934278D0,
     &                0.4965814805066249549705403530622792D0,
     &                0.0416621148288076427920788515983419D0,
     &                0.4679329057294235782681900853617119D0,
     &                0.9695311989037220561945405830595324D0,
     &                0.7597243875386241295553271953226612D0,
     &                0.2954993169683015000000000000000100D0,
     &                0.6256063821576970270701920926669370D0,
     &                0.8721744472331847929031830014156074D0,
     &                0.7475123194400060400624067817608753D0,
     &                0.5988687908832380598061676972635110D0 /)
          B(8:L) = (/ 0.0289250916202182460715280477140682D0,
     &                0.2344417552635687745426605309129788D0,
     &                0.4959112466607535754230345000437552D0,
     &                0.3534176945414970676263249907709938D0,
     &                0.1127286418142197686188888676807420D0,
     &                0.1990702787978578813133914398155831D0,
     &                0.3035851830713260765320205120458494D0  /)
          W(1:L) = (/ 0.0447568714443446293718364767042551D0,  ! Weights
     &                0.0173668850267477964504911176477604D0,
     &                0.0305993480761035327226656472689570D0,
     &                0.0285877085785997802070400912176892D0,
     &                0.0066474319297536932323184955454668D0,
     &                0.0074761894020185118222455734708010D0,
     &                0.0250499865038387453145589519055078D0,
     &                0.0014798108921196449448095368275048D0,
     &                0.0051211362467481060658943504057326D0,
     &                0.0273173593695928059185316898423957D0,
     &                0.0140057286759092815978663321140118D0,
     &                0.0078092756974583600981098732328800D0,
     &                0.0181657284597916721760720775172237D0,
     &                0.0274443739924583277620834554147845D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.18) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 14
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 3,3,3,3,6,6,6,6,6,6,6,6,6,6 /)         ! Multipl.
          A(1:L) = (/ 0.0732708864643828315786196714876895D0,  ! Points
     &                0.0039177489832282316427840744195806D0,
     &                0.4675973189887110616515129966229624D0,
     &                0.4179162109674113120121268105139935D0,
     &                0.1653816933602894800544902692391766D0,
     &                0.2875008944057839899961939131396606D0,
     &                0.1258893143198247960170648399490380D0,
     &                0.0632219159465026144935750801169980D0,
     &                0.0789102274540205177520722103754889D0,
     &                0.0380580535067857143261189915962621D0,
     &                0.0142903521304540256499241103130749D0,
     &                0.0129672723432531723123416343300903D0,
     &                0.0076485948208408993307926288182273D0,
     &                0.0127104605722554679311424918135822D0 /)
          B(5:L) = (/ 0.5636967056608707538051458939380737D0,
     &                0.2860423261392047491209581074803029D0,
     &                0.6960432186424611957925748602819539D0,
     &                0.7605455518876824326145947637978687D0,
     &                0.5920196312717585633226205754022254D0,
     &                0.6836812596359998524801240874538131D0,
     &                0.8517040371370558150285216534427664D0,
     &                0.5747324928881490288994509386896897D0,
     &                0.7355104408307292987031352244816406D0,
     &                0.9393450876437317887074042026828225D0 /)
          W(1:L) = (/ 0.0139778616452860209795840079905549D0,  ! Weights
     &                0.0005549069792132137850684555152509D0,
     &                0.0210268138197046690284298685162450D0,
     &                0.0340182121799276997472265274182211D0,
     &                0.0279101658047749951418434740078169D0,
     &                0.0182146861271508661267339566206858D0,
     &                0.0142670236581097930775198241095567D0,
     &                0.0142371230906750507043127637741560D0,
     &                0.0192575838546747877991373836820213D0,
     &                0.0097051322843806411487822763323902D0,
     &                0.0076297881343321289957824556338534D0,
     &                0.0106187391363503447944635436705283D0,
     &                0.0057106698032758388134142143826895D0,
     &                0.0043268574608764182945223447328327D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.19) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 17
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L)  = (/ 1,3,3,3,3,3,3,3,3,6,6,6,6,6,6,6,6 /)    ! Multip.
          A(1:L)  = (/ 0.3333333333333333333333333333333333D0, ! Points
     &                 0.4896099870730063319661310657482982D0,
     &                 0.4545368926978926620467593905357283D0,
     &                 0.4014166806494311873939956238106886D0,
     &                 0.2555516544030976113221817681092679D0,
     &                 0.1770779421521295516426752065159011D0,
     &                 0.1100610532279518613000849516773740D0,
     &                 0.0555286242518396712486784124713557D0,
     &                 0.0126218637772286684902347667787060D0,
     &                 0.6006337947946450000000000000000000D0,
     &                 0.1344667545307797856120431989326469D0,
     &                 0.7209870258173650552166529023382789D0,
     &                 0.5945270689558709246138892880265067D0,
     &                 0.8393314736808385786174900771484052D0,
     &                 0.2238614240979156913033693895065364D0,
     &                 0.8229313240698566316274715591605332D0,
     &                 0.9243442526207840294558591379015631D0 /)
          B(10:L) = (/ 0.3957547873569428623047946940658279D0,
     &                 0.5576032615887839683639532425011810D0,
     &                 0.2645669484065202080403017349012149D0,
     &                 0.3585393522059505884249269906459009D0,
     &                 0.1578074059685947447376736033595065D0,
     &                 0.7010879789261733673232883365595116D0,
     &                 0.1424216011133834373155747568772374D0,
     &                 0.0654946280829377033923265249859256D0 /)
          W(1:L)  = (/ 0.0329063313889186520836143448464750D0, ! Weights
     &                 0.0103307318912720533670399635717483D0,
     &                 0.0223872472630163925291845560351627D0,
     &                 0.0302661258694680708652801909825912D0,
     &                 0.0304909678021977810000315865785204D0,
     &                 0.0241592127416409049118480309866400D0,
     &                 0.0160508035868008752916227702764295D0,
     &                 0.0080845802617840604818056732421944D0,
     &                 0.0020793620274847807513475016743984D0,
     &                 0.0038848769049813897567049919927727D0,
     &                 0.0255741606120219038929297019526003D0,
     &                 0.0088809035733380577455259247035175D0,
     &                 0.0161245467617313912197852693278377D0,
     &                 0.0024919418174906754405846475759496D0,
     &                 0.0182428401189505783776657132097361D0,
     &                 0.0102585637361985213080480700423581D0,
     &                 0.0037999288553019139790731537136397D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.20) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 18
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,3,6,6,6,6,6,6,6,6,6,6,6,6 /)   ! Multip.
          A(1:L) = (/ 0.3333333333333333333333333333333333D0,  ! Points
     &                0.2158743059329919731902545438401828D0,
     &                0.0753767665297472780972854309459163D0,
     &                0.0103008281372217921136862160096969D0,
     &                0.4936022112987001655119208321450536D0,
     &                0.4615509381069252967410487102915180D0,
     &                0.3286214064242369933034974609509133D0,
     &                0.2604803617865687564195930170811535D0,
     &                0.1370742358464553000000000000000000D0,
     &                0.1467269458722997843041609884874530D0,
     &                0.0269989777425532900000000000000000D0,
     &                0.0618717859336170268417124700122339D0,
     &                0.0477243674276219962083526801042934D0,
     &                0.1206005151863643799672337870400794D0,
     &                0.0026971477967097876716489145012827D0,
     &                0.0030156332779423626572762598234710D0,
     &                0.0299053757884570188069287738643386D0,
     &                0.0067566542224609885399458175192278D0 /)
          B(7:L) = (/ 0.4293405702582103752139588004663984D0,
     &                0.1015775342809694461687550061961797D0,
     &                0.7100659730011301599879040745464079D0,
     &                0.4985454776784148493896226967076119D0,
     &                0.0491867226725820016197037125775872D0,
     &                0.7796601465405693953603506190768108D0,
     &                0.3704915391495476369201496202567388D0,
     &                0.8633469487547526484979879960925217D0,
     &                0.0561949381877455029878923019865887D0,
     &                0.2086750067484213509575944630613577D0,
     &                0.7211512409120340910281041502050941D0,
     &                0.6400554419405418899040536682721647D0 /)
          W(1:L) = (/ 0.0125376079944966565735856367723948D0,  ! Weights
     &                0.0274718698764242137484535496073598D0,
     &                0.0097652722770514230413646914294237D0,
     &                0.0013984195353918235239233631597867D0,
     &                0.0092921026251851826304282034030330D0,
     &                0.0165778760323669253260236250351840D0,
     &                0.0206677623486650769614219700129729D0,
     &                0.0208222355211545073068785561993297D0,
     &                0.0095686384198490606888758450458320D0,
     &                0.0244527709689724638856439207024089D0,
     &                0.0031557306306305340038264003207296D0,
     &                0.0121367963653212969370133090807574D0,
     &                0.0149664801438864490365249118515707D0,
     &                0.0063275933217777395693240327504398D0,
     &                0.0013425603120636958849798512981433D0,
     &                0.0027760769163475540677293561558015D0,
     &                0.0107398444741849415551734474479517D0,
     &                0.0053678057381874532052474100212697D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.21) THEN                                 ! Ref [2]
C-----------------------------------------------------------------------
          L = 19
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1,3,3,3,3,3,3,6,6,6,6,6,6,6,6,6,6,6,6 /) ! Multip.
          A(1:L) = (/ 0.3333333333333333333333333333333333D0,  ! Points
     &                0.2009352770650852798729618515641637D0,
     &                0.4376591659619271797318338441880541D0,
     &                0.0034339564905961768509599122096049D0,
     &                0.0466434847753067534951762404321419D0,
     &                0.3864222517630714909403520241677264D0,
     &                0.0954354711085309101085716810414760D0,
     &                0.9555138033504563605013147251467712D0,
     &                0.8866388134288682261249005746914376D0,
     &                0.7842628458804341542966439903981954D0,
     &                0.8829239550502000327113489873168897D0,
     &                0.6689919644410772404913224832098946D0,
     &                0.5520721210355609641571609652527788D0,
     &                0.7975929655965685676293142232957258D0,
     &                0.6775147151197714846349911663441326D0,
     &                0.5429974155890916053311361168391934D0,
     &                0.7054599055699685616588563415406017D0,
     &                0.5748005730665084622159824505498500D0,
     &                0.4717788085046148166039770401349242D0 /)
          B(8:L) = (/ 0.0357186278731633582380416089754387D0,
     &                0.1081432249156462115273886110463127D0,
     &                0.2074644495998764568243804295157274D0,
     &                0.0856847087203169400000000000000100D0,
     &                0.3214940030142888168816832126834860D0,
     &                0.4379422187933413835523680769629170D0,
     &                0.1619164530635778567510067702038591D0,
     &                0.2745047674019949038590029729073332D0,
     &                0.4053359980750069279498908953763256D0,
     &                0.1877376806564353427728167439451200D0,
     &                0.3056968347660551665127925566498432D0,
     &                0.3121444668708908816708046058155764D0 /)
          W(1:L) = (/ 0.0275622569528764809669070448245143D0,  ! Weights
     &                0.0220602154134885011913507340331164D0,
     &                0.0234600159386714884930134449523000D0,
     &                0.0003268895950471905462145575015465D0,
     &                0.0032653194629399682343353040958667D0,
     &                0.0117564629154127977043079692133821D0,
     &                0.0117807684199115168455575790986761D0,
     &                0.0022688108188011408053357043343043D0,
     &                0.0025960109644363200606737836654882D0,
     &                0.0046345297858718602123478905615969D0,
     &                0.0047943360545488579348574487199119D0,
     &                0.0057124788367236115672506383429634D0,
     &                0.0058658276043221216369557987000023D0,
     &                0.0094137630590915875898182685203471D0,
     &                0.0134149437966564249100220266108931D0,
     &                0.0157169180920832459435000011378462D0,
     &                0.0168636830144369045916509638861999D0,
     &                0.0213900270853200983778322980803590D0,
     &                0.0230767921894926813678808755218915D0 /)
C-----------------------------------------------------------------------
        ELSE
C-----------------------------------------------------------------------
          PRINT*,'  ******** ERROR!!! D must be 1 <= D <= 21 ********  '
          PRINT*,'  ********      for REGION = TRIANGLE      ********  '
          PRINT*,'    Execution terminated in subroutine quadrature    '
          STOP
        ENDIF

C.......Vertices and area for the master triangular element

        V1   = (/ -1.D0, -1.D0 /)
        V2   = (/  1.D0, -1.D0 /)
        V3   = (/ -1.D0,  1.D0 /)
        AREA = 2.D0

C.......Count up number of quadrature points

      N = 0
      DO I = 1,L
        N = N + M(I)
      ENDDO
C      ALLOCATE ( PTS(N,2), WTS(N) )
C.......Transform quadrature points to master element coordinates

        J = 1
        DO I = 1,L
          IF (M(I).EQ.1) THEN
            B(I) = A(I)
            C(I) = B(I)
            PTS(J,1)   = V1(1)*A(I) + V2(1)*B(I) + V3(1)*C(I)
            PTS(J,2)   = V1(2)*A(I) + V2(2)*B(I) + V3(2)*C(I)
            WTS(J)     = AREA*W(I)
            J = J + 1
          ELSEIF (M(I).EQ.3) THEN
            B(I) = A(I)
            C(I) = 1.D0 - (A(I) + B(I))
            PTS(J,1)   = V1(1)*A(I) + V2(1)*B(I) + V3(1)*C(I)
            PTS(J,2)   = V1(2)*A(I) + V2(2)*B(I) + V3(2)*C(I)
            WTS(J)     = AREA*W(I)
            PTS(J+1,1) = V1(1)*B(I) + V2(1)*C(I) + V3(1)*A(I)
            PTS(J+1,2) = V1(2)*B(I) + V2(2)*C(I) + V3(2)*A(I)
            WTS(J+1)   = AREA*W(I)
            PTS(J+2,1) = V1(1)*C(I) + V2(1)*A(I) + V3(1)*B(I)
            PTS(J+2,2) = V1(2)*C(I) + V2(2)*A(I) + V3(2)*B(I)
            WTS(J+2)   = AREA*W(I)
            J = J + 3
          ELSEIF (M(I).EQ.6) THEN
            C(I) = 1.D0 - (A(I) + B(I))
            PTS(J,1)   = V1(1)*A(I) + V2(1)*B(I) + V3(1)*C(I)
            PTS(J,2)   = V1(2)*A(I) + V2(2)*B(I) + V3(2)*C(I)
            WTS(J)     = AREA*W(I)
            PTS(J+1,1) = V1(1)*B(I) + V2(1)*C(I) + V3(1)*A(I)
            PTS(J+1,2) = V1(2)*B(I) + V2(2)*C(I) + V3(2)*A(I)
            WTS(J+1)   = AREA*W(I)
            PTS(J+2,1) = V1(1)*C(I) + V2(1)*A(I) + V3(1)*B(I)
            PTS(J+2,2) = V1(2)*C(I) + V2(2)*A(I) + V3(2)*B(I)
            WTS(J+2)   = AREA*W(I)
            PTS(J+3,1) = V1(1)*A(I) + V2(1)*C(I) + V3(1)*B(I)
            PTS(J+3,2) = V1(2)*A(I) + V2(2)*C(I) + V3(2)*B(I)
            WTS(J+3)   = AREA*W(I)
            PTS(J+4,1) = V1(1)*B(I) + V2(1)*A(I) + V3(1)*C(I)
            PTS(J+4,2) = V1(2)*B(I) + V2(2)*A(I) + V3(2)*C(I)
            WTS(J+4)   = AREA*W(I)
            PTS(J+5,1) = V1(1)*C(I) + V2(1)*B(I) + V3(1)*A(I)
            PTS(J+5,2) = V1(2)*C(I) + V2(2)*B(I) + V3(2)*A(I)
            WTS(J+5)   = AREA*W(I)
            J = J + 6
          ENDIF
        ENDDO

C-----------------------------------------------------------------------
C                        SQUARE QUADRATURE RULES
C-----------------------------------------------------------------------
C
C     All rules have positive weights (with the exception of rule 23,
C     which has 1 negative weight) with all points located inside the
C     square (so-called PI rules). Rules marked by * are optimal.  The
C     rest are the best PI rules currently known.
C
C     References:

C     [1] A.H. Stroud, "Approximate calculation of multiple integrals",
C         Prentice-Hall, Englewood Cliffs, N.J., 1971.
C
C     [2] J.W. Wissman and T. Becker, "Partially Symmetric Cubature
C         Formulas for Even Degrees of Exactness", SIAM Journal on
C         Numerical Analysis, 23, 676--685, 1986.
C
C     [3] Construction of Cubature Formulas of Degree Seven and Nine
C         Using Symmetric Planar Regions, Using Orthogonal Polynmials",
C         SIAM Journal on Numerical Analysis, 14, 492--508, 1977.
C
C     [4] I.P. Omelyan and V.B. Solovyan, "Improved cubature formulae of
C         high degrees of exactness for the square", Journal of Compu-
C         tational and Applied Mathematics, 188, 190--204, 2006.
C
C     [5] H.M. Moller, "Minimum-Point Cubature Formula", Numerische
C         Mathematik, 25, 185--200, 1976. (in German)
C
C-----------------------------------------------------------------------

      ELSEIF (REGION == 'SQUARE  ') THEN

C-----------------------------------------------------------------------
        IF (D.LE.1) THEN                                      ! Ref [1]*
C-----------------------------------------------------------------------
          L = 1
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1 /)                                ! Multiplicity
          A(1:L) = (/ 0.000000000000000D0 /)              ! Point
          B(1:L) = (/ 0.000000000000000D0 /)
          W(1:L) = (/ 4.000000000000000D0 /)              ! Weight
C-----------------------------------------------------------------------
        ELSEIF (D.LE.2) THEN                                  ! Ref [1]
C-----------------------------------------------------------------------
          L = 3
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1,1,1 /)
          A(1:L) = (/ 0.81649658092773D0,
     &               -0.40824829046386D0,
     &               -0.40824829046386D0 /)
          B(1:L) = (/ 0.00000000000000D0,
     &                0.70710678118655D0,
     &               -0.70710678118655D0 /)
          W(1:L) = (/ 1.33333333333333D0,
     &                1.33333333333333D0,
     &                1.33333333333333D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.3) THEN                                  ! Ref [1]*
C-----------------------------------------------------------------------
          L = 1
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 4 /)                                ! Multiplicity
          A(1:L) = (/ 0.577350269189626D0 /)              ! Points
          B(1:L) = (/ 0.577350269189626D0 /)
          W(1:L) = (/ 1.000000000000000D0 /)              ! Weights
C-----------------------------------------------------------------------
        ELSEIF (D.LE.4) THEN                                  ! Ref [2]*
C-----------------------------------------------------------------------
          L = 6
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1,1,1,1,1,1 /)                          ! Multipl.
          A(1:L) = (/  0.000000000000000D0,                   ! Points
     &                 0.000000000000000D0,
     &                 0.851914653304601D0,
     &                 0.630912788976754D0,
     &                -0.851914653304601D0,
     &                -0.630912788976754D0 /)
          B(1:L) = (/  0.000000000000000D0,
     &                 0.966091783079296D0,
     &                 0.455603727836193D0,
     &                -0.731629951573135D0,
     &                 0.455603727836193D0,
     &                -0.731629951573135D0 /)
          W(1:L) = (/  1.142857142857143D0,                   ! Weights
     &                 0.439560439560440D0,
     &                 0.566072207007532D0,
     &                 0.642719001783677D0,
     &                 0.566072207007532D0,
     &                 0.642719001783677D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.5) THEN                                  ! Ref [1]*
C-----------------------------------------------------------------------
          L = 7
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1, 1, 1, 1, 1, 1, 1 /)
          A(1:L) = (/  0.00000000000000D0,
     &                 0.00000000000000D0,
     &                 0.00000000000000D0,
     &                 0.77459666924148D0,
     &                 0.77459666924148D0,
     &                -0.77459666924148D0,
     &                -0.77459666924148D0 /)
          B(1:L) = (/  0.00000000000000D0,
     &                 0.96609178307930D0,
     &                -0.96609178307930D0,
     &                 0.57735026918963D0,
     &                -0.57735026918963D0,
     &                 0.57735026918963D0,
     &                -0.57735026918963D0 /)
          W(1:L) = (/  1.14285714285714D0,
     &                 0.31746031746032D0,
     &                 0.31746031746032D0,
     &                 0.55555555555556D0,
     &                 0.55555555555556D0,
     &                 0.55555555555556D0,
     &                 0.55555555555556D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.6) THEN                                  ! Ref [2]*
C-----------------------------------------------------------------------
          L = 10
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1,1,1,1,1,1,1,1,1,1 /)
          A(1:L) = (/    0.000000000000000D0,
     &                   0.000000000000000D0,
     &                   0.888764014654765D0,
     &                   0.604857639464685D0,
     &                   0.955447506641064D0,
     &                   0.565459993438754D0,
     &                  -0.888764014654765D0,
     &                  -0.604857639464685D0,
     &                  -0.955447506641064D0,
     &                  -0.565459993438754D0 /)
          B(1:L) =  (/   0.836405633697626D0,
     &                  -0.357460165391307D0,
     &                   0.872101531193131D0,
     &                   0.305985162155427D0,
     &                  -0.410270899466658D0,
     &                  -0.872869311156879D0,
     &                   0.872101531193131D0,
     &                   0.305985162155427D0,
     &                  -0.410270899466658D0,
     &                  -0.872869311156879D0 /)
          W(1:L) =  (/   0.455343245714174D0,
     &                   0.827395973202966D0,
     &                   0.144000884599645D0,
     &                   0.668259104262665D0,
     &                   0.225474004890679D0,
     &                   0.320896396788441D0,
     &                   0.144000884599645D0,
     &                   0.668259104262665D0,
     &                   0.225474004890679D0,
     &                   0.320896396788441D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.7) THEN                                  ! Ref [3]*
C-----------------------------------------------------------------------
          L = 4
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 2,2,2,2 /)                          ! Multiplicity
          A(1:L) = (/ 0.91711782231277058626D0,           ! Points
     &                0.61126876646532841440D0,
     &                0.52942280204265532589D0,
     &                0.00000000000000000000D0 /)
          B(1:L) = (/ 0.54793120682809232377D0,
     &                0.93884325665885830459D0,
     &                0.00000000000000000000D0,
     &                0.62704137378039531763D0 /)
          W(1:L) = (/ 0.21305721162094912651D0,           ! Weights
     &                0.17400948894689560610D0,
     &                0.63585388344327977182D0,
     &                0.59001271542103076297D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.8) THEN                                  ! Ref [2]
C-----------------------------------------------------------------------
          L = 16
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 /)
          A(1:L) = (/   0.000000000000000D0,
     &                  0.000000000000000D0,
     &                  0.000000000000000D0,
     &                  0.000000000000000D0,
     &                  0.906662316102171D0,
     &                  0.560348127669843D0,
     &                  0.518695856299547D0,
     &                  0.839267525316398D0,
     &                  0.553832724273449D0,
     &                  0.342287447682940D0,
     &                 -0.906662316102171D0,
     &                 -0.560348127669843D0,
     &                 -0.518695856299547D0,
     &                 -0.839267525316398D0,
     &                 -0.553832724273449D0,
     &                 -0.342287447682940D0 /)
          B(1:L) = (/   0.000000000000000D0,
     &                  0.953321175521807D0,
     &                 -0.882458098900126D0,
     &                  0.582334188120499D0,
     &                  0.294592444333741D0,
     &                 -0.771253032094644D0,
     &                  0.713923598834010D0,
     &                 -0.272694549383947D0,
     &                  0.179951160534772D0,
     &                 -0.471118254595022D0,
     &                  0.294592444333741D0,
     &                 -0.771253032094644D0,
     &                  0.713923598834010D0,
     &                 -0.272694549383947D0,
     &                  0.179951160534772D0,
     &                 -0.471118254595022D0 /)
          W(1:L) = (/   0.334521439965580D0,  ! Weights
     &                  0.087911387704639D0,
     &                  0.167628039106469D0,
     &                  0.305874815913735D0,
     &                  0.087911387704639D0,
     &                  0.087911387704639D0,
     &                  0.167628039106469D0,
     &                  0.167628039106469D0,
     &                  0.305874815913735D0,
     &                  0.305874815913735D0,
     &                  0.087911387704639D0,
     &                  0.087911387704639D0,
     &                  0.167628039106469D0,
     &                  0.167628039106469D0,
     &                  0.305874815913735D0,
     &                  0.305874815913735D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.9) THEN                                  ! Ref [5]*
C-----------------------------------------------------------------------
          L = 5
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1,4,4,4,4 /)
          A(1:L) = (/ 0.00000000000000000000,
     &                0.96884996636197772072,
     &                0.75027709997890053354,
     &                0.52373582021442933604,
     &                0.07620832819261717318 /)
          B(1:L) = (/ 0.00000000000000000000,
     &                0.63068011973166885417,
     &                0.92796164595956966740,
     &                0.45333982113564719076,
     &                0.85261572933366230775 /)
          W(1:L) = (/ 0.52674897119341563786,
     &                0.08887937817019870697,
     &                0.11209960212959648528,
     &                0.39828243926207009528,
     &                0.26905133763978080301/)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.10) THEN                                 ! Ref []
C-----------------------------------------------------------------------
          L = 22
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = 1
          A(1:L) = (/  4.7324898849276598e-01,
     &                -3.5072672608918981e-01,
     &                -4.7113921490701688e-01,
     &                 3.2110023120386515e-02,
     &                 1.0733227865108741e-01,
     &                 8.1037492260191812e-01,
     &                -7.7882541598318511e-01,
     &                -6.4763548426267536e-01,
     &                 3.9247487539609610e-01,
     &                 7.6050655071397388e-01,
     &                -8.1171510601648733e-01,
     &                -1.1429517364223797e-01,
     &                 7.5296563247996007e-01,
     &                -6.2402437958984702e-01,
     &                -2.0650134619887220e-01,
     &                 5.0891319042960681e-01,
     &                -9.8171192640479688e-01,
     &                -9.4061855719921172e-01,
     &                -9.2254816825741193e-01,
     &                 9.5380192234255112e-01,
     &                 9.6634208368735852e-01,
     &                 9.5774959160007522e-01  /)
          B(1:L) = (/  1.6557852510038315e-01,
     &                 1.8447172062121983e-01,
     &                -6.6664733059821124e-01,
     &                -3.1879357593640706e-01,
     &                 6.1886619139299248e-01,
     &                 6.1159678303492504e-01,
     &                -2.1052738914821550e-01,
     &                 6.4749469817525440e-01,
     &                -7.6311149392438349e-01,
     &                -3.6631391678067937e-01,
     &                -9.2466842429053542e-01,
     &                -9.4921913140887015e-01,
     &                -9.7071837396777472e-01,
     &                 9.8538331193146012e-01,
     &                 9.1195887103573425e-01,
     &                 9.2152907557898267e-01,
     &                -6.2586619353239670e-01,
     &                 3.1884535968392919e-01,
     &                 8.7923480439903223e-01,
     &                -7.5512692061435549e-01,
     &                 1.0431232556636386e-01,
     &                 9.2621050012583894e-01 /)
          W(1:L) = (/  3.7171764930896173e-01,
     &                 3.8811447402440874e-01,
     &                 2.8395842218278933e-01,
     &                 4.0824197726154576e-01,
     &                 3.1498878221231136e-01,
     &                 2.0018320620277513e-01,
     &                 2.6587113477126029e-01,
     &                 2.3057004553370086e-01,
     &                 2.5827939410342804e-01,
     &                 2.6042397681916851e-01,
     &                 8.8686202216975499e-02,
     &                 1.1861767207465973e-01,
     &                 5.9110195150351146e-02,
     &                 3.3387129247073037e-02,
     &                 1.3460977386198075e-01,
     &                 1.3337731192240113e-01,
     &                 6.3269272761110995e-02,
     &                 1.1984158532391266e-01,
     &                 6.2537941187552140e-02,
     &                 7.1805898760516657e-02,
     &                 9.7940429484131938e-02,
     &                 3.4467525588983812e-02 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.11) THEN                                 ! Ref [5]*
C-----------------------------------------------------------------------
          L = 6
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 4,4,4,4,4,4 /)
          A(1:L) = (/ 0.98263922354085547295e+00,
     &                0.82577583590296393730e+00,
     &                0.18858613871864195460e+00,
     &                0.81252054830481310049e+00,
     &                0.52532025036454776234e+00,
     &                0.41658071912022368274e-01 /)
          B(1:L) = (/ 0.69807610454956756478e+00,
     &                0.93948638281673690721e+00,
     &                0.95353952820153201585e+00,
     &                0.31562343291525419599e+00,
     &                0.71200191307533630655e+00,
     &                0.42484724884866925062e+00 /)
          W(1:L) = (/ 0.48020763350723814563e-01,
     &                0.66071329164550595674e-01,
     &                0.97386777358668164196e-01,
     &                0.21173634999894860050e+00,
     &                0.22562606172886338740e+00,
     &                0.35115871839824543766e+00 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.12) THEN                                 ! Ref [ ]
C-----------------------------------------------------------------------
          L = 31
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = 1
          A(1:L) = (/ -3.8131119459148788e-01,
     &                 6.4573191109453948e-02,
     &                -1.0834321329194775e-02,
     &                -3.1882703020851938e-01,
     &                 4.9124051440092803e-01,
     &                -2.0906799447670715e-01,
     &                 1.8948337189272124e-01,
     &                -6.9740094114568829e-01,
     &                -5.8402513589553640e-01,
     &                 4.4701377237977313e-01,
     &                 3.4867912208378016e-01,
     &                -8.2562697914640848e-01,
     &                 8.2839794669248942e-02,
     &                -4.0351974647584699e-01,
     &                 6.5401042056406233e-01,
     &                -9.0264377285460362e-01,
     &                -8.5295397551927077e-01,
     &                 8.2216786295901656e-01,
     &                 7.4510555770497011e-01,
     &                -9.4133986362315170e-01,
     &                -5.4461187387612175e-01,
     &                 7.4407322966908984e-01,
     &                -7.2254885481492603e-01,
     &                 6.7524406569352735e-01,
     &                 9.3807676975195520e-01,
     &                -9.9171408764710778e-01,
     &                -9.7391149358748841e-01,
     &                -9.2231295237113653e-01,
     &                 9.5557708019583965e-01,
     &                 9.8216591295043421e-01,
     &                 9.2557212335129857e-01  /)
          B(1:L) = (/ -1.5398000784199919e-01,
     &                -4.9794871568657245e-01,
     &                 1.2224478971657705e-01,
     &                -7.3294898893865745e-01,
     &                -7.8409257688727241e-01,
     &                 6.5611051497298534e-01,
     &                 8.9911805536738287e-01,
     &                -4.2248127033807525e-01,
     &                 3.3100645378716304e-01,
     &                -2.2659664973677845e-01,
     &                 4.3860404955163790e-01,
     &                -7.8339223275580994e-01,
     &                -9.4230798695085749e-01,
     &                 9.6482881096343187e-01,
     &                 7.3857098028675039e-01,
     &                -1.5881852211379360e-02,
     &                 4.0163251602231481e-01,
     &                -5.2660748692256265e-01,
     &                 1.0988549815212308e-01,
     &                -9.5414148142964417e-01,
     &                -9.5530036379122441e-01,
     &                -9.7744835460673618e-01,
     &                 7.9662230649630528e-01,
     &                 9.9626110485909680e-01,
     &                 8.8729244026658205e-01,
     &                -5.2853945477454323e-01,
     &                 5.9955340548238656e-01,
     &                 9.5082592343728289e-01,
     &                -8.4903353418547223e-01,
     &                -1.6369711363774472e-01,
     &                 4.7425880434330858e-01  /)
          W(1:L) = (/  2.3598701292933691e-01,
     &                 2.4110813600847844e-01,
     &                 2.7048224227639595e-01,
     &                 1.8648166880884143e-01,
     &                 1.7241958393889878e-01,
     &                 2.4109442092821515e-01,
     &                 1.4125391453247216e-01,
     &                 1.8292025454973745e-01,
     &                 2.2222997581864359e-01,
     &                 2.4904537785770031e-01,
     &                 2.5112362229462498e-01,
     &                 9.2811359998802967e-02,
     &                 9.8238337173087234e-02,
     &                 6.8583817743889233e-02,
     &                 1.5506938444449642e-01,
     &                 1.3182320881366066e-01,
     &                 6.0068518355283269e-02,
     &                 1.5766018519773284e-01,
     &                 1.9930860602643424e-01,
     &                 2.1719109379092324e-02,
     &                 6.4596098758824216e-02,
     &                 4.0584519909105145e-02,
     &                 1.2603341007939087e-01,
     &                 3.0006912476756006e-02,
     &                 4.4974753329261395e-02,
     &                 3.8721244577288268e-02,
     &                 4.7718056922379071e-02,
     &                 3.0056189691189335e-02,
     &                 4.4499282846528827e-02,
     &                 5.6566093223890265e-02,
     &                 9.6814701109561335e-02  /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.13) THEN                                 ! Ref [5]
C-----------------------------------------------------------------------
          L = 9
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 1,4,4,4,4,4,4,4,4 /)
          A(1:L) = (/ 0.00000000000000000000e+00,
     &                0.77880971155441942252e+00,
     &                0.95729769978630736566e+00,
     &                0.13818345986246535375e+00,
     &                0.94132722587292523695e+00,
     &                0.47580862521827590507e+00,
     &                0.75580535657208143627e+00,
     &                0.69625007849174941396e+00,
     &                0.34271655604040678941e+00 /)
          B(1:L) = (/ 0.00000000000000000000e+00,
     &                0.98348668243987226379e+00,
     &                0.85955600564163892859e+00,
     &                0.95892517028753485754e+00,
     &                0.39073621612946100068e+00,
     &                0.85007667369974857597e+00,
     &                0.64782163718701073204e+00,
     &                0.70741508996444936217e-01,
     &                0.40930456169403884330e+00 /)
          W(1:L) = (/ 0.30038211543122536139e+00,
     &                0.29991838864499131666e-01,
     &                0.38174421317083669640e-01,
     &                0.60424923817749980681e-01,
     &                0.77492738533105339358e-01,
     &                0.11884466730059560108e+00,
     &                0.12976355037000271129e+00,
     &                0.21334158145718938943e+00,
     &                0.25687074948196783651e+00 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.15) THEN                                 ! Ref [4]
C-----------------------------------------------------------------------
          L = 11
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4 /)     ! Multipl.
          A(1:L) = (/ 0.98798456650771809034922121236542D0,  ! Pointts
     &                0.90815949600657000212015099547736D0,
     &                0.67928365833453304991325391003325D0,
     &                0.50911373411758353514778637359508D0,
     &                0.97675332466910190352385200798077D0,
     &                0.75619936719149244012005066365912D0,
     &                0.89778569328633877480008574782677D0,
     &                0.20599307074252141729418963873618D0,
     &                0.45144312511299139017533875886564D0,
     &                0.66683824538360873834071399129626D0,
     &                0.74295704755765822553432311307323D-1 /)
          B(1:L) = (/ 0.77126821223875533899886933446485D0,
     &                0.95703183434690690872237176442598D0,
     &                0.88260197593087253601344445274335D0,
     &                0.97120312974183699854692313856226D0,
     &                0.83559862608781647288448365846813D-1,
     &                0.75619936719149244012005066365912D0,
     &                0.46676265923796434848237353795400D0,
     &                0.84079448454078540426562160968883D0,
     &                0.56245686233219940637540066298377D0,
     &                0.19046630243571720761679616635243D0,
     &                0.32397702249753019818251854432752D0 /)
          W(1:L) = (/ 0.20881470204497523521771058289754D-1, ! Weights
     &                0.25545901574497276542640153395248D-1,
     &                0.31203866624933300871149690867662D-1,
     &                0.38010761595074827467645518285610D-1,
     &                0.41449061852426148002787373214871D-1,
     &                0.79320407004083334044710201039891D-1,
     &                0.88901265758751523303980720079987D-1,
     &                0.12016982158206027507823569713056D0,
     &                0.16882043410639799754153511014621D0,
     &                0.16987162497336185160489786440053D0,
     &                0.21582538472391594202064661314968D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.17) THEN                                 ! Ref [4]
C-----------------------------------------------------------------------
          L = 14
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 4,4,4,4,4,4,4,4,4,4,4,4,4,4 /)         ! Multipl.
          A(1:L) = (/ 0.83395914422050762595707520328329D0,  ! Points
     &                0.96701240760377864958940778776159D0,
     &                0.98651441086033068583570701960810D0,
     &                0.17035060808995408160378979789427D-1,
     &                0.42523896522453030941022314252505D0,
     &                0.88194109089215356624316729768736D0,
     &                0.69978907719058600912388980227382D0,
     &                0.90858412958838344797723547617253D0,
     &                0.73933759205292015806620475085721D0,
     &                0.21246155837885419289305793553062D0,
     &                0.15644172095846342514322716437912D0,
     &                0.50398563819427997044830482422504D0,
     &                0.58243895074467257078462336257058D0,
     &                0.28970323065541272212557470108155D0 /)
          B(1:L) = (/ 0.99690134998258294114169765276688D0,
     &                0.92101565015369642619085740576658D0,
     &                0.56251780244667252352153081833715D0,
     &                0.98204914256843033449712481990261D0,
     &                0.95796453236865195741899809390262D0,
     &                0.74117688569732509081061208741447D0,
     &                0.88728024293255774907349992409998D0,
     &                0.25843122151820770173022364732347D0,
     &                0.47295583257297618882242532468520D0,
     &                0.00000000000000000000000000000000D0,
     &                0.81259212523912311994061744159953D0,
     &                0.68201093297792530795370853308359D0,
     &                0.11846544560647891209927499369579D0,
     &                0.40876985953794338411643329876836D0 /)
          W(1:L) = (/ 0.10693483986974526468925667171638D-1, ! Weights
     &                0.16771622989325482379964908559201D-1,
     &                0.21520834803173017585623196363995D-1,
     &                0.24893201532665059892584476318209D-1,
     &                0.42463258472030940473501779894230D-1,
     &                0.53711265037645010830029221647514D-1,
     &                0.54579479693382460849318673206721D-1,
     &                0.67375653622461385504403959336007D-1,
     &                0.98025282885102299426881768287454D-1,
     &                0.98325651584666601742691443856667D-1,
     &                0.10576898319665727200249259468733D0,
     &                0.10593453574575401283483020818374D0,
     &                0.14990405484916921950315250394890D0,
     &                0.15003269160099271050559959853839D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.19) THEN                                 ! Ref [4]
C-----------------------------------------------------------------------
          L = 17
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4 /)   ! Multipl.
          A(1:L) = (/ 0.93790944060174636724164305692148D0,  ! Points
     &                0.59787966519157168521483636741590D0,
     &                0.96865781747798834472115427804246D0,
     &                0.98871713276447330663578670732177D0,
     &                0.98398534132338386681313796251589D0,
     &                0.36585775934555586089438861852973D0,
     &                0.78392149176096602345110934186655D0,
     &                0.86937144898957875204792277623522D0,
     &                0.91889377777573801032232199904313D0,
     &                0.14078396804456848628363687508206D0,
     &                0.56379666815446526573028097449771D0,
     &                0.76200274293070327698230061865243D0,
     &                0.69745388342191267884442122044750D0,
     &                0.52310392339404494392757182766006D0,
     &                0.30566836903929191370033838487568D0,
     &                0.44898642628288082765338494532756D0,
     &                0.98253418759835132805054567507033D-1  /)
          B(1:L) = (/ 0.99998546072852907260205380652647D0,
     &                0.98732847941781540087026300838966D0,
     &                0.89837495163532572964949889543009D0,
     &                0.62259634389530287767136776393609D0,
     &                0.81109463487824943619725131193050D-1,
     &                0.96462400422891970516096923553526D0,
     &                0.93756444544378175318295617860873D0,
     &                0.74380866034597101765279618918913D0,
     &                0.38410875822737883260638757649426D0,
     &                0.87987957307981017658529064786666D0,
     &                0.81879210607636015929368719928237D0,
     &                0.15749920122732269808023356410127D0,
     &                0.54657527460177776847334916572487D0,
     &                0.00000000000000000000000000000000D0,
     &                0.65017670270687960549278395428873D0,
     &                0.34240465380680230945939322837053D0,
     &                0.23509621629115532325303789785547D0 /)
          W(1:L) = (/ 0.42157189312457273371400997162954D-2,  ! Weights
     &                0.99237601014741223600089798896376D-2,
     &                0.15078678879581549295330034135223D-1,
     &                0.15121496864822956266676863866018D-1,
     &                0.23821621047339582724750103846036D-1,
     &                0.28746437252189671047629194361029D-1,
     &                0.31348715503861464721826917341708D-1,
     &                0.49762852666717116332578404045926D-1,
     &                0.55534775159604041101829554407116D-1,
     &                0.65013710432173970207381031565964D-1,
     &                0.73819068900731731823980126564345D-1,
     &                0.90385825968150641564727715959435D-1,
     &                0.91881833336425013923433485117405D-1,
     &                0.94967142638856099564605740671378D-1,
     &                0.10498174724102843457467466433826D0,
     &                0.11871336850928058424347422704556D0,
     &                0.12668324656651729290995285712867D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.21) THEN                                 ! Ref [4]
C-----------------------------------------------------------------------
          L = 21
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) = (/ 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1 /)
          A(1:L) = (/ 0.99742844318071465788852153329446D0,  ! Points
     &                0.90092205722857715090631770295789D0,
     &                0.98137581661152322617866583081353D0,
     &                0.47562398846061921636952360049609D0,
     &                0.68396217875524370909034162562144D-1,
     &                0.96445171170290974019893928634261D0,
     &                0.96789534067760540982739074113386D0,
     &                0.71204626183902144323409345553631D0,
     &                0.86686503563504933746419509606443D0,
     &                0.29388895765490255861532312924984D0,
     &                0.88245289720509646533706783064117D0,
     &                0.88356465549777630296872390851348D0,
     &                0.53714330328796591598235477256257D0,
     &                0.73297737278688849035966507531475D0,
     &                0.74340815897994389367005251095709D0,
     &                0.14352379867257862891820869134808D0,
     &                0.57716374806487034338151001622839D0,
     &                0.38010653105519745774291045326124D0,
     &                0.49380304750704567296572150088764D0,
     &                0.23300694276964919884562248755586D0,
     &                0.00000000000000000000000000000000D0 /)
          B(1:L) = (/ 0.52349333540342268677302187698119D0,
     &                0.99213624611198765984022577926158D0,
     &                0.93577766500519228442627576803182D0,
     &                0.98806503981406364167006543205075D0,
     &                0.98289142121346795894575007552095D0,
     &                0.73079564192792033198229729840349D0,
     &                0.28416943704022564251542547384397D0,
     &                0.95001737577395264422880843244573D0,
     &                0.85754514904426211818642071770359D0,
     &                0.91478375374420147743639913929870D0,
     &                0.78310571319347967606817150072422D-1,
     &                0.50650027819745540446699219481203D0,
     &                0.82111662321535962574448188332070D0,
     &                0.67811474157990352881988795983159D0,
     &                0.25891212405917942502949658613377D0,
     &                0.73714284444878233387764988974016D0,
     &                0.42605137832252378501649531823938D0,
     &                0.59190980196005469388929534014808D0,
     &                0.46968438389915362845722235027390D-1,
     &                0.27854054992870057594151995625227D0,
     &                0.00000000000000000000000000000000D0 /)
          W(1:L) = (/ 0.59245289910274777823163684444026D-2,  ! Weights
     &                0.63181879993530976749052313712955D-2,
     &                0.77654356771885822575525989789117D-2,
     &                0.13313236524649387539261801099149D-1,
     &                0.18028023632000303112294832251383D-1,
     &                0.20759211084811453614957408545828D-1,
     &                0.24345594686962939048122829629801D-1,
     &                0.27291829813157459363923440908365D-1,
     &                0.31313724489320677669626239379042D-1,
     &                0.43028684463625497581941353350492D-1,
     &                0.47435107497760585342967184111271D-1,
     &                0.49535232791099913534195616930148D-1,
     &                0.59086609737522776429493659734483D-1,
     &                0.61598898755573131953283218720393D-1,
     &                0.68662882737105569078247834904061D-1,
     &                0.77511025760449779132628565445376D-1,
     &                0.77655900861398148704502327066780D-1,
     &                0.84165159143253389201574044182295D-1,
     &                0.11664395742356559711226466539621D0,
     &                0.12587077966701428595400393561138D0,
     &                0.13498395305263979164774737575571D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.23) THEN                                 ! Ref [4]
C-----------------------------------------------------------------------
          L = 25
          ALLOCATE( A(L), B(L), M(L), W(L) )
          M(1:L) =(/4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4/)
          A(1:L) = (/  0.22475776435269587875683347524503D0,
     &                 0.87420793087689680287386901266229D0,
     &                 0.97602267261364022197431910391898D0,
     &                 0.98901025758028347071424940975698D0,
     &                 0.99326920924031633712313940841625D0,
     &                 0.56499592316621278816917834165965D0,
     &                 0.12479933234667809522764885071235D0,
     &                 0.90240439932034384398117518141661D0,
     &                 0.96603416099961004557874518675109D0,
     &                 0.74327403381257379390317209035852D0,
     &                 0.94397158234337348119479988763974D0,
     &                 0.36473593323821554671165638117641D0,
     &                 0.90025309287443275420616285586643D0,
     &                 0.48034665839500246850252725186282D-1,
     &                 0.54919116214309328871373834754894D0,
     &                 0.86487537690899969927500100353866D0,
     &                 0.78769621309348012773202186731599D0,
     &                 0.57671028420945643394316234476328D0,
     &                 0.20013408262762044788586320030931D0,
     &                 0.74602728783032388650354427676695D0,
     &                 0.64177280458672645848207064078009D0,
     &                 0.40236411309752397363192555539035D0,
     &                 0.46993983120051570507268178090848D0,
     &                 0.22491749438123049571812018957130D0,
     &                 0.22831753386455276245209947736815D0 /)
          B(1:L) = (/  0.29562926123440075779470457695520D0,
     &                 0.99164484170232374329954582252223D0,
     &                 0.96038644389988149213812916422733D0,
     &                 0.79476170695439095037125111357424D0,
     &                 0.45269906826670511998507618989211D0,
     &                 0.98963443963546680882582623594845D0,
     &                 0.98891634511573107523317221688555D0,
     &                 0.86681747165850322502643568236158D0,
     &                 0.22128837983587450545659391256077D0,
     &                 0.93739279789140167477396439558006D0,
     &                 0.62734373811214363563025812471848D0,
     &                 0.93654053553190687038241524198386D0,
     &                 0.2507099034142795181 3078348104539D-1,
     &                 0.65304687691990057591624038872149D0,
     &                 0.00000000000000000000000000000000D0,
     &                 0.42021700731140387645536924573814D0,
     &                 0.71486137179637184939863361570348D0,
     &                 0.82649643106250383189783444260321D0,
     &                 0.80824267349292209367541999626505D0,
     &                 0.20581981165646397971556679713472D0,
     &                 0.51516637687706181290564290685967D0,
     &                 0.64890781819854093908140818020446D0,
     &                 0.27714799151429808758023024246803D0,
     &                 0.40375503517268762210602535023913D0,
     &                 0.56116790982355323182358196190726D-1 /)
          W(1:L) = (/ -0.22499144590180737573666435988313D-1,
     &                 0.56757797279709720956600059513997D-2,
     &                 0.61294541632385752564605990154598D-2,
     &                 0.77307399716921584473393426863691D-2,
     &                 0.79851030689059360294239183531451D-2,
     &                 0.10747724909071103372536638574027D-1,
     &                 0.14073722901914630236333688287280D-1,
     &                 0.22950166656215871772211451659864D-1,
     &                 0.23104503668552704581666880144042D-1,
     &                 0.24886583460620943481070103801115D-1,
     &                 0.25495608710781325077549951029551D-1,
     &                 0.35148791457392415926700843453924D-1,
     &                 0.39967612471275640012053163262252D-1,
     &                 0.42210906199290840139296408236284D-1,
     &                 0.45629308917602135087674549832202D-1,
     &                 0.47184931543983842485535616621711D-1,
     &                 0.48004360511784007777329600464972D-1,
     &                 0.51407132281965816724265717022986D-1,
     &                 0.54210495031621259406088939636629D-1,
     &                 0.63980226470850872129000560206633D-1,
     &                 0.71999854713967554049756153858067D-1,
     &                 0.74130368424485001536304396403399D-1,
     &                 0.87075597857073455631778823034765D-1,
     &                 0.10080008323810791275764368651352D0,
     &                 0.11197008823181576355998539793872D0 /)
C-----------------------------------------------------------------------
        ELSE
C-----------------------------------------------------------------------
          PRINT*,'  ******** ERROR!!! D must be 1 <= D <= 23 ********  '
          PRINT*,'  ********       for REGION = SQUARE       ********  '
          PRINT*,'    Execution terminated in subroutine quadrature    '
          STOP
        ENDIF

C.......Count up number of quadrature points

        N = 0
        DO I = 1,L
          N = N + M(I)
        ENDDO

C        ALLOCATE ( PTS(N,2), WTS(N) )
C.......Transform quadrature points to master element coordinates

        J = 1
        DO I = 1,L
          IF (M(I).EQ.1) THEN
            PTS(J,1)   =  A(I)
            PTS(J,2)   =  B(I)
            WTS(J)     =  W(I)
            J = J + M(I)
          ELSEIF (M(I).EQ.2) THEN
            PTS(J,1)   =  A(I)
            PTS(J,2)   =  B(I)
            WTS(J)     =  W(I)
            PTS(J+1,1) = -A(I)
            PTS(J+1,2) = -B(I)
            WTS(J+1)   =  W(I)
            J = J + M(I)
          ELSEIF (M(I).EQ.4) THEN
            PTS(J,1)   =  A(I)
            PTS(J,2)   =  B(I)
            WTS(J)     =  W(I)
            PTS(J+1,1) = -B(I)
            PTS(J+1,2) =  A(I)
            WTS(J+1)   =  W(I)
            PTS(J+2,1) = -A(I)
            PTS(J+2,2) = -B(I)
            WTS(J+2)   =  W(I)
            PTS(J+3,1) =  B(I)
            PTS(J+3,2) = -A(I)
            WTS(J+3)   =  W(I)
            J = J + M(I)
          ENDIF
        ENDDO

C-----------------------------------------------------------------------
C                        TRIANGULAR PRISM QUADRATURE RULES
C-----------------------------------------------------------------------
C
C     All rules have positive weights with all points located inside the
C     triangle (so-called PI rules). Rules marked by * are optimal.  The
C     rest are the best PI rules currently known.
C
C     [1] E.J. Kubatko, "Efficient cubature rules for triangular prisms"
C         in preparation.
C
C-----------------------------------------------------------------------

      ELSEIF (REGION == 'TRIPRISM') THEN

C-----------------------------------------------------------------------
        IF (D.LE.1) THEN                                      ! Ref [1]*
C-----------------------------------------------------------------------
          L = 1
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1 /)
          A(1:L) = (/ -0.3333333333333333333D0 /)
          B(1:L) = (/ -0.3333333333333333333D0 /)
          C(1:L) = (/  0.0000000000000000000D0 /)
          W(1:L) = (/  4.0000000000000000000D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.2) THEN                                  ! Ref [1]*
C-----------------------------------------------------------------------
          L = 4
          ALLOCATE( A(L), B(L), C(L), M(L), W(L) )
          M(1:L) = (/ 1, 1, 1, 1 /)
          A(1:L) = (/  0.24401693585629D0,
     &                -0.91068360252296D0,
     &                -0.33333333333333D0,
     &                -0.33333333333333D0 /)
          B(1:L) = (/ -0.33333333333333D0,
     &                 0.24401693585629D0,
     &                -0.91068360252296D0,
     &                -0.91068360252296D0 /)
          C(1:L) = (/  0.00000000000000D0,
     &                 0.00000000000000D0,
     &                 1.00000000000000D0,
     &                -1.00000000000000D0 /)
          W(1:L) = (/  1.33333333333333D0,
     &                 1.33333333333333D0,
     &                 0.66666666666667D0,
     &                 0.66666666666667D0 /)
C-----------------------------------------------------------------------
        ELSEIF (D.LE.3) THEN                                  ! Ref [1]
C-----------------------------------------------------------------------
C-----------------------------------------------------------------------
        ELSE
C-----------------------------------------------------------------------
          PRINT*,'  ******** ERROR!!! D must be 1 <= D <= 4  ********  '
          PRINT*,'  ********       for REGION = SQUARE       ********  '
          PRINT*,'    Execution terminated in subroutine quadrature    '
          STOP
        ENDIF

C.......Count up number of quadrature points

        N = 0
        DO I = 1,L
          N = N + M(I)
        ENDDO
C        ALLOCATE ( PTS(N,3), WTS(N) )

C.......Transform quadrature points to master element coordinates

        J = 1
        DO I = 1,N
          IF (M(I).EQ.1) THEN
            PTS(J,1)   =  A(I)
            PTS(J,2)   =  B(I)
            PTS(J,3)   =  C(I)
            WTS(J)     =  W(I)
            J = J + M(I)
          ENDIF
        ENDDO
C-----------------------------------------------------------------------
      ELSE
C-----------------------------------------------------------------------
          PRINT*,'  ********  ERROR!!! REGION must be EDGE,  ********  '
          PRINT*,'  ********  TRIANGLE, SQUARE OR TRIPRISM   ********  '
          PRINT*,'    Execution terminated in subroutine quadrature    '
          STOP
      ENDIF
      RETURN
      END SUBROUTINE QUADRATURE
